<!DOCTYPE html>
<html lang="id" class="h-full bg-white">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Ampera Pak Jenggot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(to bottom right, #fdfbfb, #f5f5f5);
      }
      .fade-slide {
        animation: fadeSlideIn 0.9s ease-out;
      }
      @keyframes fadeSlideIn {
        0% { opacity: 0; transform: translateY(30px); }
        100% { opacity: 1; transform: translateY(0); }
      }
      .hover-glow:hover {
        box-shadow: 0 0 0 3px rgba(127, 29, 29, 0.2);
        transform: translateY(-2px);
        transition: all 0.2s ease;
      }
    </style>
  </head>
  <body class="h-full flex items-center justify-center px-4 relative">
    <div class="w-full max-w-sm bg-white rounded-3xl shadow-2xl border border-gray-200 p-8 fade-slide">
      <!-- Logo -->
      <div class="text-center mb-6">
        <img src="https://i.imgur.com/EftciFn.png" alt="Logo Ampera Pak Jenggot" class="mx-auto mb-4" />
      </div>

      <!-- Form Login -->
      <form class="space-y-4" id="loginForm">
        <input
          id="username"
          type="text"
          placeholder="Username"
          class="w-full px-4 py-3 rounded-xl bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-red-800 text-sm hover-glow"
        />
        <input
          id="password"
          type="password"
          placeholder="Kata Sandi"
          class="w-full px-4 py-3 rounded-xl bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-red-800 text-sm hover-glow"
        />

        <!-- âœ… Checkbox Ingat Saya -->
        <label class="flex items-center space-x-2 text-sm">
          <input type="checkbox" id="rememberMe" class="rounded text-red-800 focus:ring-red-800">
          <span>Ingat saya</span>
        </label>

        <!-- Tombol Login -->
        <button
          type="submit"
          id="loginButton"
          class="w-full py-3 rounded-xl bg-red-800 hover:bg-red-900 text-white font-semibold transition shadow-lg hover:shadow-xl hover:scale-[1.02] flex items-center justify-center gap-2"
        >
          <span id="loginText">Masuk</span>
          <svg
            id="spinner"
            class="hidden w-5 h-5 animate-spin text-white"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
        </button>
      </form>
    </div>

    <!-- Notifikasi -->
    <div id="notification" class="fixed inset-0 flex items-center justify-center z-50 pointer-events-none">
      <div
        id="notificationBox"
        class="hidden px-6 py-4 rounded-2xl shadow-xl text-white text-base font-semibold transition-all duration-300 transform scale-95 opacity-0 pointer-events-auto"
      ></div>
    </div>

<script>
  const form = document.getElementById('loginForm');
  const button = document.getElementById('loginButton');
  const spinner = document.getElementById('spinner');
  const loginText = document.getElementById('loginText');
  const notificationBox = document.getElementById('notificationBox');

  // âœ… Menampilkan notifikasi sukses / error
  function showNotification(message, type = 'success') {
    notificationBox.textContent = message;
    notificationBox.className = 'px-6 py-4 rounded-2xl shadow-xl text-white text-base font-semibold transition-all duration-300 transform pointer-events-auto';
    notificationBox.classList.remove('hidden', 'opacity-0', 'scale-95');
    notificationBox.classList.add(type === 'success' ? 'bg-green-600' : 'bg-red-600', 'opacity-100', 'scale-100');

    setTimeout(() => {
      notificationBox.classList.remove('opacity-100', 'scale-100');
      notificationBox.classList.add('opacity-0', 'scale-95');
      setTimeout(() => notificationBox.classList.add('hidden'), 300);
    }, 3000);
  }

  // âœ… Cek apakah user sudah login sebelumnya
  window.addEventListener('DOMContentLoaded', () => {
    const savedUser = localStorage.getItem('user') || sessionStorage.getItem('user');
    if (savedUser) {
      const user = JSON.parse(savedUser);
      showNotification('Selamat datang kembali, ' + user.nama + '!', 'success');
      // ðŸ‘‰ Redirect ke dashboard jika sudah login
      // window.location.href = 'dashboard.html';
    }
  });

  // âœ… Proses saat form dikirim
  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const remember = document.getElementById('rememberMe').checked;

    if (!username || !password) {
      showNotification('Silakan isi username dan kata sandi.', 'error');
      return;
    }

    spinner.classList.remove('hidden');
    loginText.textContent = 'Memproses...';
    button.disabled = true;
    button.classList.add('opacity-70', 'cursor-not-allowed');

    try {
      const response = await fetch("https://73f028f8-bd14-4194-9c1e-24fe7a2603ce-00-3hxvqdfpmtznr.sisko.replit.dev/api/user", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();

      if (data.status === 'success') {
        // âœ… Simpan user ke localStorage jika ingat saya dicentang
        const storage = remember ? localStorage : sessionStorage;
        storage.setItem('user', JSON.stringify(data.user));

        showNotification('Login berhasil. Selamat datang, ' + data.user.nama + '!', 'success');

        // ðŸ‘‰ Redirect ke dashboard jika sudah disiapkan
        // window.location.href = 'dashboard.html';
      } else {
        showNotification(data.message || 'Login gagal. Coba lagi.', 'error');
      }

    } catch (err) {
      console.error('Fetch error:', err);
      showNotification('Terjadi kesalahan saat menghubungi server.', 'error');
    } finally {
      spinner.classList.add('hidden');
      loginText.textContent = 'Masuk';
      button.disabled = false;
      button.classList.remove('opacity-70', 'cursor-not-allowed');
    }
  });
</script>

  </body>
</html>
